# An auxiliary file for causing temporary error on replica SQL thread.

--echo # [ on replica ]
connection replica;
BEGIN;
--echo # It will lock table t1 on the row in which c1 is 1 until COMMIT or ROLLBACK
UPDATE t1 SET c2= "replica" WHERE c1= 1;

connection primary;
--echo # [ on primary ]
BEGIN;
INSERT INTO t3 VALUES(1);
eval $statement;
eval UPDATE t1 SET c2='$statement' WHERE c1= 1;
COMMIT;
save_primary_pos;

connection replica;
--echo # [ on replica ]
let $replica_sql_errno= 1205;
source include/wait_for_replica_sql_error.inc;

ROLLBACK;

START REPLICA SQL_THREAD;
source include/wait_for_replica_sql_to_start.inc;

sync_with_primary;
