#####################
# Change Author: JBM
# Change Date: 2006-01-17
# Change: added order by in select
##################### 
source include/primary-replica.inc;

reset primary;
source include/show_primary_status.inc;
save_primary_pos;
connection replica;
stop replica;
reset replica;
--vertical_results
#checking show replica status
let $status_items= Primary_Host,Primary_User,Primary_Log_File,Read_Primary_Log_Pos,Relay_Primary_Log_File,Replica_IO_Running,Replica_SQL_Running,Replicate_Do_DB,Replicate_Ignore_DB,Replicate_Do_Table,Replicate_Ignore_Table,Replicate_Wild_Do_Table,Replicate_Wild_Ignore_Table,Last_Errno,Last_Error,Skip_Counter,Exec_Primary_Log_Pos,Until_Condition,Until_Log_File,Until_Log_Pos,Primary_SSL_Allowed,Primary_SSL_CA_File,Primary_SSL_CA_Path,Primary_SSL_Cert,Primary_SSL_Cipher,Primary_SSL_Key,Primary_SSL_Verify_Server_Cert,Last_IO_Errno,Last_IO_Error,Last_SQL_Errno,Last_SQL_Error,Replicate_Ignore_Server_Ids,Primary_Server_Id;
source include/show_replica_status.inc; 

change primary to primary_host='127.0.0.1';
# The following needs to be cleaned up when change primary is fixed
--vertical_results
#checking show replica status
let $status_items= Primary_Host,Primary_User,Primary_Log_File,Read_Primary_Log_Pos,Relay_Primary_Log_File,Replica_IO_Running,Replica_SQL_Running,Replicate_Do_DB,Replicate_Ignore_DB,Replicate_Do_Table,Replicate_Ignore_Table,Replicate_Wild_Do_Table,Replicate_Wild_Ignore_Table,Last_Errno,Last_Error,Skip_Counter,Exec_Primary_Log_Pos,Until_Condition,Until_Log_File,Until_Log_Pos,Primary_SSL_Allowed,Primary_SSL_CA_File,Primary_SSL_CA_Path,Primary_SSL_Cert,Primary_SSL_Cipher,Primary_SSL_Key,Primary_SSL_Verify_Server_Cert,Last_IO_Errno,Last_IO_Error,Last_SQL_Errno,Last_SQL_Error,Replicate_Ignore_Server_Ids,Primary_Server_Id;
source include/show_replica_status.inc; 
--replace_result $PRIMARY_MYPORT PRIMARY_PORT
eval change primary to primary_host='127.0.0.1',primary_user='root',
 primary_password='',primary_port=$PRIMARY_MYPORT;
--vertical_results
--replace_result $PRIMARY_MYPORT PRIMARY_PORT
#checking show replica status
let $status_items= Primary_Host,Primary_User,Primary_Log_File,Read_Primary_Log_Pos,Relay_Primary_Log_File,Replica_IO_Running,Replica_SQL_Running,Replicate_Do_DB,Replicate_Ignore_DB,Replicate_Do_Table,Replicate_Ignore_Table,Replicate_Wild_Do_Table,Replicate_Wild_Ignore_Table,Last_Errno,Last_Error,Skip_Counter,Exec_Primary_Log_Pos,Until_Condition,Until_Log_File,Until_Log_Pos,Primary_SSL_Allowed,Primary_SSL_CA_File,Primary_SSL_CA_Path,Primary_SSL_Cert,Primary_SSL_Cipher,Primary_SSL_Key,Primary_SSL_Verify_Server_Cert,Last_IO_Errno,Last_IO_Error,Last_SQL_Errno,Last_SQL_Error,Replicate_Ignore_Server_Ids,Primary_Server_Id;
source include/show_replica_status.inc; 
start replica;
sync_with_primary;
--vertical_results
#checking show replica status
let $status_items= Primary_Host,Primary_User,Connect_Retry,Primary_Log_File,Read_Primary_Log_Pos,Relay_Primary_Log_File,Relay_Primary_Log_File,Replica_IO_Running,Replica_SQL_Running,Replicate_Do_DB,Replicate_Ignore_DB,Replicate_Do_Table,Replicate_Ignore_Table,Replicate_Wild_Do_Table,Replicate_Wild_Ignore_Table,Last_Errno,Last_Error,Skip_Counter,Exec_Primary_Log_Pos,Until_Condition,Until_Log_File,Until_Log_Pos,Primary_SSL_Allowed,Primary_SSL_CA_File,Primary_SSL_CA_Path,Primary_SSL_Cert,Primary_SSL_Cipher,Primary_SSL_Key,Primary_SSL_Verify_Server_Cert,Last_IO_Errno,Last_IO_Error,Last_SQL_Errno,Last_SQL_Error,Replicate_Ignore_Server_Ids,Primary_Server_Id;
source include/show_replica_status.inc; 
connection primary;
--disable_warnings
drop table if exists t1;
--enable_warnings
create table t1 (n int, PRIMARY KEY(n));
insert into t1 values (10),(45),(90);
sync_replica_with_primary;
connection replica;
SELECT * FROM t1 ORDER BY n;
connection primary;
SELECT * FROM t1 ORDER BY n;
drop table t1;
sync_replica_with_primary;
