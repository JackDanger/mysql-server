--source include/not_embedded.inc
--source include/have_federated_plugin.inc

# Uninstall will not uninstall if ps has been used
--disable_ps_protocol

connect (primary,localhost,root,,test,$PRIMARY_MYPORT,);
connect (replica,localhost,root,,test,$REPLICA_MYPORT,);

connection primary;
CREATE TABLE t2(a int);

connection replica;
CREATE TABLE t1(a int) ENGINE=FEDERATED
  CONNECTION='mysql://root@localhost:$PRIMARY_MYPORT/test/t2';
DROP TABLE t1;

--replace_result $FEDERATED_PLUGIN FEDERATED_PLUGIN
eval INSTALL PLUGIN federated SONAME '$FEDERATED_PLUGIN';
--replace_result $FEDERATED_PLUGIN FEDERATED_PLUGIN
--error ER_UDF_EXISTS
eval INSTALL PLUGIN FEDERATED SONAME '$FEDERATED_PLUGIN';

UNINSTALL PLUGIN federated;

--replace_result $FEDERATED_PLUGIN FEDERATED_PLUGIN
eval INSTALL PLUGIN federated SONAME '$FEDERATED_PLUGIN';

CREATE TABLE t1(a int) ENGINE=FEDERATED
  CONNECTION='mysql://root@localhost:$PRIMARY_MYPORT/test/t2';
DROP TABLE t1;

UNINSTALL PLUGIN federated;
--error ER_SP_DOES_NOT_EXIST
UNINSTALL PLUGIN federated;

connection primary;
DROP TABLE t2;
