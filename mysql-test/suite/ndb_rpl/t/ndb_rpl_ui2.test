# The include statement below is a temp one for tests that are yet to
#be ported to run with InnoDB,
#but needs to be kept for tests that would need MyISAM in future.
--source include/force_myisam_default.inc

--source include/have_ndb.inc
--source include/have_binlog_format_mixed_or_row.inc
--source suite/ndb_rpl/ndb_primary-replica.inc

--connection primary

CREATE TABLE t1 (pk int primary key, uk int not null, unique(uk)) engine=ndb;

--sync_replica_with_primary
--connection replica
STOP REPLICA;
insert into t1 values (1,1);
insert into t1 values (2,2);
--connection primary
begin;
insert into t1 values (1,2);
insert into t1 values (2,1);
commit;
delete from t1;
begin;
insert into t1 values (1,1);
insert into t1 values (2,2);
commit;

--connection replica
start replica;

--connection primary
--sync_replica_with_primary
--connection replica
--sorted_result
select * from t1;

--connection primary
drop table t1;
--sync_replica_with_primary

--source include/rpl_end.inc
