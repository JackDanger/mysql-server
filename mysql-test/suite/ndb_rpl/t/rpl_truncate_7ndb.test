# The include statement below is a temp one for tests that are yet to
#be ported to run with InnoDB,
#but needs to be kept for tests that would need MyISAM in future.
--source include/force_myisam_default.inc


--source include/have_ndb.inc
--source suite/ndb_rpl/ndb_primary-replica.inc
--source include/have_binlog_format_mixed_or_row.inc

--disable_query_log
--disable_warnings
connection replica;
STOP REPLICA;
connection primary;
DROP TABLE IF EXISTS t1;
RESET PRIMARY;
connection replica;
DROP TABLE IF EXISTS t1;
RESET REPLICA;
START REPLICA;
--enable_warnings
--enable_query_log

--echo **** On Primary ****
connection primary;
CREATE TABLE t1 (a INT PRIMARY KEY, b LONG) ENGINE=NDB;
INSERT INTO t1 VALUES (1,1), (2,2);
SELECT * FROM t1 ORDER BY a,b;
--echo **** On Replica ****
# This is silly, but NDB doesn't add to the binlog fast enough
--real_sleep 10
sync_replica_with_primary;
INSERT INTO t1 VALUE (3,3);
SELECT * FROM t1 ORDER BY a,b;
--echo **** On Primary ****
connection primary;
TRUNCATE TABLE t1;
SELECT * FROM t1 ORDER BY a,b;
--echo **** On Replica ****
sync_replica_with_primary;
# Should be empty
SELECT * FROM t1 ORDER BY a,b;
--echo **** On Primary ****
connection primary;
DROP TABLE t1;
source include/show_binlog_events.inc;

--echo **** On Primary ****
connection primary;
CREATE TABLE t1 (a INT PRIMARY KEY, b LONG) ENGINE=NDB;
INSERT INTO t1 VALUES (1,1), (2,2);
SELECT * FROM t1 ORDER BY a,b;
--echo **** On Replica ****
sync_replica_with_primary;
INSERT INTO t1 VALUE (3,3);
SELECT * FROM t1 ORDER BY a,b;
--echo **** On Primary ****
connection primary;
DELETE FROM t1;
SELECT * FROM t1 ORDER BY a,b;
--echo **** On Replica ****
sync_replica_with_primary;
# Should be empty
SELECT * FROM t1 ORDER BY a,b;
--echo **** On Primary ****
connection primary;
DROP TABLE t1;
source include/show_binlog_events.inc;

--source include/rpl_end.inc
