include/primary-replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection primary]
**** On Primary ****
drop table if exists test.marker;
create table test.marker(a int) engine=innodb;
insert into test.marker values (1);
select * from test.marker;
a
1
truncate table performance_schema.events_waits_history_long;
truncate table performance_schema.events_statements_summary_by_digest;
update performance_schema.setup_instruments
set enabled='YES', timed='YES';
**** On Replica ****
truncate table performance_schema.events_waits_history_long;
truncate table performance_schema.events_statements_summary_by_digest;
update performance_schema.setup_instruments
set enabled='YES', timed='NO';
**** On Primary ****
select * from performance_schema.setup_instruments
where timed='NO';
NAME	ENABLED	TIMED
select "This better be in the primary" as in_primary_digest;
in_primary_digest
This better be in the primary
insert into performance_schema.setup_objects
values ('TABLE', 'primary', 'foo', 'YES', 'YES');
select * from performance_schema.setup_objects
order by object_type, object_schema, object_name;
OBJECT_TYPE	OBJECT_SCHEMA	OBJECT_NAME	ENABLED	TIMED
EVENT	%	%	YES	YES
EVENT	information_schema	%	NO	NO
EVENT	mysql	%	NO	NO
EVENT	performance_schema	%	NO	NO
FUNCTION	%	%	YES	YES
FUNCTION	information_schema	%	NO	NO
FUNCTION	mysql	%	NO	NO
FUNCTION	performance_schema	%	NO	NO
PROCEDURE	%	%	YES	YES
PROCEDURE	information_schema	%	NO	NO
PROCEDURE	mysql	%	NO	NO
PROCEDURE	performance_schema	%	NO	NO
TABLE	%	%	YES	YES
TABLE	information_schema	%	NO	NO
TABLE	primary	foo	YES	YES
TABLE	mysql	%	NO	NO
TABLE	performance_schema	%	NO	NO
TRIGGER	%	%	YES	YES
TRIGGER	information_schema	%	NO	NO
TRIGGER	mysql	%	NO	NO
TRIGGER	performance_schema	%	NO	NO
select digest, digest_text, count_star
from performance_schema.events_statements_summary_by_digest
where digest_text like "%in_%_digest%";
digest	digest_text	count_star
9e4eacbaab0cc999ecd94ce65aa73196	SELECT ? AS `in_primary_digest` 	1
insert into test.marker values (2);
**** On Replica ****
select * from test.marker;
a
1
2
select * from performance_schema.setup_instruments
where timed='YES';
NAME	ENABLED	TIMED
select "This better be in the replica" as in_replica_digest;
in_replica_digest
This better be in the replica
insert into performance_schema.setup_objects
values ('TABLE', 'replica', 'foo', 'YES', 'YES');
select * from performance_schema.setup_objects
order by object_type, object_schema, object_name;
OBJECT_TYPE	OBJECT_SCHEMA	OBJECT_NAME	ENABLED	TIMED
EVENT	%	%	YES	YES
EVENT	information_schema	%	NO	NO
EVENT	mysql	%	NO	NO
EVENT	performance_schema	%	NO	NO
FUNCTION	%	%	YES	YES
FUNCTION	information_schema	%	NO	NO
FUNCTION	mysql	%	NO	NO
FUNCTION	performance_schema	%	NO	NO
PROCEDURE	%	%	YES	YES
PROCEDURE	information_schema	%	NO	NO
PROCEDURE	mysql	%	NO	NO
PROCEDURE	performance_schema	%	NO	NO
TABLE	%	%	YES	YES
TABLE	information_schema	%	NO	NO
TABLE	mysql	%	NO	NO
TABLE	performance_schema	%	NO	NO
TABLE	replica	foo	YES	YES
TRIGGER	%	%	YES	YES
TRIGGER	information_schema	%	NO	NO
TRIGGER	mysql	%	NO	NO
TRIGGER	performance_schema	%	NO	NO
select digest, digest_text, count_star
from performance_schema.events_statements_summary_by_digest
where digest_text like "%in_%_digest%";
digest	digest_text	count_star
1edf6036686652c02c13c7479516c898	SELECT ? AS `in_replica_digest` 	1
**** On Primary ****
delete from performance_schema.setup_objects
where object_schema='primary';
**** On Replica ****
delete from performance_schema.setup_objects
where object_schema='replica';
select * from performance_schema.setup_objects;
OBJECT_TYPE	OBJECT_SCHEMA	OBJECT_NAME	ENABLED	TIMED
EVENT	mysql	%	NO	NO
EVENT	performance_schema	%	NO	NO
EVENT	information_schema	%	NO	NO
EVENT	%	%	YES	YES
FUNCTION	mysql	%	NO	NO
FUNCTION	performance_schema	%	NO	NO
FUNCTION	information_schema	%	NO	NO
FUNCTION	%	%	YES	YES
PROCEDURE	mysql	%	NO	NO
PROCEDURE	performance_schema	%	NO	NO
PROCEDURE	information_schema	%	NO	NO
PROCEDURE	%	%	YES	YES
TABLE	mysql	%	NO	NO
TABLE	performance_schema	%	NO	NO
TABLE	information_schema	%	NO	NO
TABLE	%	%	YES	YES
TRIGGER	mysql	%	NO	NO
TRIGGER	performance_schema	%	NO	NO
TRIGGER	information_schema	%	NO	NO
TRIGGER	%	%	YES	YES
include/rpl_end.inc
