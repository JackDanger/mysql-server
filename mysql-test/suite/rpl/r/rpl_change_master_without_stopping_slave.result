include/primary-replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection primary]

Create a replication user to use in change primary tests.

set @orig_sql_mode= @@sql_mode;
set sql_mode= (select replace(@@sql_mode,'NO_AUTO_CREATE_USER',''));
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
GRANT REPLICATION REPLICA ON *.* TO replssl@localhost REQUIRE SSL;
Warnings:
Warning	1287	Using GRANT for creating new user is deprecated and will be removed in future release. Create new user with CREATE USER statement.
set sql_mode= @orig_sql_mode;
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
include/sync_replica_sql_with_primary.inc

With both receiver and applier stopped, all CHANGE PRIMARY options should
be allowed.

include/stop_replica.inc
CHANGE PRIMARY TO PRIMARY_AUTO_POSITION= 0;
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
CHANGE PRIMARY TO RELAY_LOG_FILE= 'RELAY_LOG_FILE';
CHANGE PRIMARY TO RELAY_LOG_POS= RELAY_LOG_POS;
CHANGE PRIMARY TO PRIMARY_AUTO_POSITION= 1;
CHANGE PRIMARY TO PRIMARY_AUTO_POSITION= 0;

With receiver stopped and applier running, we should be able to change
receiver options. Setting applier options should throw the correct error
message.

include/start_replica_sql.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
CHANGE PRIMARY TO PRIMARY_AUTO_POSITION= 1;
ERROR HY000: This operation cannot be performed with running replication threads; run STOP REPLICA FOR CHANNEL '' first
CHANGE PRIMARY TO RELAY_LOG_FILE= 'RELAY_LOG_FILE';
ERROR HY000: This operation cannot be performed with a running replica sql thread; run STOP REPLICA SQL_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO RELAY_LOG_POS= RELAY_LOG_POS;
ERROR HY000: This operation cannot be performed with a running replica sql thread; run STOP REPLICA SQL_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_DELAY= 10;
ERROR HY000: This operation cannot be performed with a running replica sql thread; run STOP REPLICA SQL_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_RETRY_COUNT= 1, RELAY_LOG_FILE= 'RELAY_LOG_FILE';
ERROR HY000: This operation cannot be performed with a running replica sql thread; run STOP REPLICA SQL_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_RETRY_COUNT= 1, RELAY_LOG_POS= RELAY_LOG_POS;
ERROR HY000: This operation cannot be performed with a running replica sql thread; run STOP REPLICA SQL_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_RETRY_COUNT= 1, PRIMARY_DELAY=10;
ERROR HY000: This operation cannot be performed with a running replica sql thread; run STOP REPLICA SQL_THREAD FOR CHANNEL '' first.

With applier stopped and receiver running, we should be able to change
applier options. Setting receiver options should throw the correct error
message.

include/stop_replica_sql.inc
include/start_replica_io.inc
CHANGE PRIMARY TO RELAY_LOG_FILE= 'RELAY_LOG_FILE';
CHANGE PRIMARY TO RELAY_LOG_POS= RELAY_LOG_POS;
CHANGE PRIMARY TO PRIMARY_DELAY= 10;
CHANGE PRIMARY TO PRIMARY_AUTO_POSITION= 1;
ERROR HY000: This operation cannot be performed with running replication threads; run STOP REPLICA FOR CHANNEL '' first
CHANGE PRIMARY TO PRIMARY_HOST= 'localhost';
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_USER= 'replssl';
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO  PRIMARY_PASSWORD= '';
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_CONNECT_RETRY= 20;
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_RETRY_COUNT= 1;
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_HEARTBEAT_PERIOD= 20;
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_SSL= 1;
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_SSL_VERIFY_SERVER_CERT= 1;
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_DELAY=10, PRIMARY_HOST= 'localhost';
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_DELAY=10, PRIMARY_USER= 'replssl';
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_DELAY=10, PRIMARY_PASSWORD= '';
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_DELAY=10, PRIMARY_CONNECT_RETRY= 20;
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_DELAY=10, PRIMARY_RETRY_COUNT= 1;
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_DELAY= 10, PRIMARY_HEARTBEAT_PERIOD= 20;
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_DELAY=10, PRIMARY_SSL=1;
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
CHANGE PRIMARY TO PRIMARY_DELAY= 10, PRIMARY_SSL_VERIFY_SERVER_CERT= 1;
ERROR HY000: This operation cannot be performed with a running replica io thread; run STOP REPLICA IO_THREAD FOR CHANNEL '' first.
include/stop_replica.inc

cleanup

CHANGE PRIMARY TO
PRIMARY_HOST= '127.0.0.1',
PRIMARY_USER= 'root',
PRIMARY_DELAY= 0,
IGNORE_SERVER_IDS= (),
PRIMARY_SSL= 0,
PRIMARY_SSL_CA= '',
PRIMARY_SSL_CERT= '',
PRIMARY_SSL_KEY= '',
PRIMARY_SSL_VERIFY_SERVER_CERT= 0;
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
CHANGE PRIMARY TO PRIMARY_AUTO_POSITION= SAVE_AUTOPOSITION;
include/start_replica.inc
DROP USER replssl@localhost;
include/rpl_end.inc
