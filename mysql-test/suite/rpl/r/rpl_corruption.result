include/primary-replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection primary]
call mtr.add_suppression('Found invalid event in binary log');
call mtr.add_suppression("Replica I/O for channel '': Relay log write failure: could not queue event from primary");
call mtr.add_suppression('event read from binlog did not pass crc check');
call mtr.add_suppression('Replication event checksum verification failed');
call mtr.add_suppression('Event crc check failed! Most likely there is event corruption');
call mtr.add_suppression("Replica SQL for channel '': Error initializing relay log position: I/O error reading event at position .*, Error_code: 1593");
SET @old_primary_verify_checksum = @@primary_verify_checksum;
# 1. Creating test table/data and set corruption position for testing
* insert/update/delete rows in table t1 *
CREATE TABLE t1 (a INT NOT NULL PRIMARY KEY, b VARCHAR(10), c VARCHAR(100));
include/sync_replica_sql_with_primary.inc
include/stop_replica.inc
# 2. Corruption in primary binlog and SHOW BINLOG EVENTS
SET GLOBAL debug="d,corrupt_read_log_event_char";
SHOW BINLOG EVENTS;
ERROR HY000: Error when executing command SHOW BINLOG EVENTS: Wrong offset or I/O error
# 3. Primary read a corrupted event from binlog and send the error to replica
SET GLOBAL debug="d,corrupt_read_log_event";
START REPLICA IO_THREAD;
include/wait_for_replica_io_error.inc [errno=1236]
# 4. Primary read a corrupted event from binlog and send it to replica
SET GLOBAL primary_verify_checksum=0;
SET GLOBAL debug="d,corrupt_read_log_event";
START REPLICA IO_THREAD;
include/wait_for_replica_io_error.inc [errno=1595,1743]
SET GLOBAL debug="";
SET GLOBAL primary_verify_checksum=1;
# 5. Replica. Corruption in network
SET GLOBAL debug="d,corrupt_queue_event";
START REPLICA IO_THREAD;
include/wait_for_replica_io_error.inc [errno=1595,1743]
# 6. Replica. Corruption in relay log
SET GLOBAL debug="d,corrupt_read_log_event_char";
START REPLICA SQL_THREAD;
include/wait_for_replica_sql_error.inc [errno=1593]
# 7. Seek diff for tables on primary and replica
SET GLOBAL debug= "";
include/start_replica.inc
include/sync_replica_sql_with_primary.inc
include/diff_tables.inc [primary:t1, replica:t1]
# 8. Clean up
SET GLOBAL primary_verify_checksum = @old_primary_verify_checksum;
DROP TABLE t1;
include/sync_replica_sql_with_primary.inc
include/rpl_end.inc
