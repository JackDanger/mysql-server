include/primary-replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection primary]
# Initial setup
[connection primary]
CREATE TABLE t1 (c1 INT) ENGINE=InnoDB;
CREATE TEMPORARY TABLE temp_t1 (c1 INT) ENGINE=InnoDB;
# Insert the data in the primary
BEGIN;
INSERT INTO temp_t1 VALUES (1);
COMMIT;
BEGIN;
INSERT INTO t1 VALUES ((SELECT COUNT(*) FROM temp_t1));
COMMIT;
include/sync_replica_sql_with_primary.inc
[connection replica]
# Stop the IO thread
include/stop_replica_io.inc
Warnings:
Warning	3022	This operation may not be safe when the replica has temporary tables. The tables will be kept open until the server restarts or until the tables are deleted by any replicated DROP statement. Suggest to wait until replica_open_temp_tables = 0.
# Restart IO thread
include/start_replica_io.inc
# Do one more insert on primary and then sync replica with primary
[connection primary]
BEGIN;
INSERT INTO t1 VALUES ((SELECT COUNT(*) FROM temp_t1));
COMMIT;
include/sync_replica_sql_with_primary.inc
# Now compare primary and replica's t1 table data
[connection primary]
include/diff_tables.inc [primary:t1, replica:t1]
# Cleanup
[connection primary]
DROP TABLE t1, temp_t1;
include/rpl_end.inc
