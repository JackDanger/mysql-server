include/primary-replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection primary]
==== Configure ====
==== Initialize ====
connection replica;
include/stop_replica.inc
connection replica;
CREATE PROCEDURE show_replica_status ()
BEGIN
DECLARE name VARCHAR(100) DEFAULT('');
WHILE name = '' DO
SHOW REPLICA STATUS;
SELECT TABLE_NAME INTO name
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_NAME = 't_end';
END WHILE;
END|
CREATE PROCEDURE read_gtid_executed ()
BEGIN
DECLARE name VARCHAR(100) DEFAULT('');
DECLARE temp VARCHAR(10000) DEFAULT('');
WHILE name = '' DO
SET temp = @@GLOBAL.GTID_EXECUTED;
SET temp = @@GLOBAL.GTID_OWNED;
SELECT TABLE_NAME INTO name
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_NAME = 't_end';
END WHILE;
END|
connection primary;
CREATE TABLE t1_1 (a INT) ENGINE = InnoDB;
CREATE TABLE t2_1 (a INT) ENGINE = InnoDB;
INSERT INTO t1_1 VALUES (0);
INSERT INTO t2_1 VALUES (0);
==== Generate binary log ====
CREATE TABLE t_end (a INT);
==== Apply the generated binary logs ====
==== Wait for load to finish ====
connection replica;
==== Check result ====
include/diff_tables.inc
connection replica;
==== Clean up ====
connection primary;
DROP TABLE t_end;
connection replica;
DROP TABLE t_end;
DROP PROCEDURE show_replica_status;
DROP PROCEDURE read_gtid_executed;
CHANGE PRIMARY TO PRIMARY_AUTO_POSITION= 0;
