include/primary-replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection primary]
call mtr.add_suppression("Got fatal error 1236 from primary when reading data from binary log: 'The replica is connecting using CHANGE PRIMARY TO PRIMARY_AUTO_POSITION = 1, but the primary has purged binary logs containing GTIDs that the replica requires.");
######## Initialize ########
CREATE TABLE t1 (a INT) ENGINE = InnoDB;
include/sync_replica_sql_with_primary.inc
include/stop_replica.inc
include/stop_dump_threads.inc
INSERT INTO t1 VALUES (1);
FLUSH LOGS;
INSERT INTO t1 VALUES (2);
PURGE BINARY LOGS TO 'primary-bin.000002';
include/assert.inc [PURGE BINARY LOGS successfully removed all but the latest files]
INSERT INTO t1 VALUES (2);
CHANGE PRIMARY TO PRIMARY_AUTO_POSITION = 1;
START REPLICA;
include/wait_for_replica_io_error.inc [errno=1236 # ER_PRIMARY_FATAL_ERROR_READING_BINLOG]
include/stop_replica_sql.inc
CHANGE PRIMARY TO PRIMARY_LOG_FILE = 'primary-bin.000002', PRIMARY_LOG_POS = PRIMARY_POS, PRIMARY_AUTO_POSITION = 0;
include/start_replica.inc
include/assert.inc [t1 should contain only one row with the value 2]
######## Clean up ########
=== Stop and reset replica/primary (connection replica) ====
include/stop_replica.inc
RESET PRIMARY;
RESET REPLICA;
=== Stop and reset primary (connection primary) ====
RESET PRIMARY;
=== Start replica (connection replica) ====
include/start_replica.inc
=== Sync replica with primary (connection primary/replica) ====
DROP TABLE t1;
include/sync_replica_sql_with_primary.inc
include/rpl_end.inc
