include/primary-replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection primary]
CALL mtr.add_suppression("Generate an incident log event before writing the "
                         "real event to the binary log for testing purposes. "
                         "An incident event has been written to the binary "
                         "log which will stop the replicas.");
SET GLOBAL DEBUG="+d,incident_database_resync_on_replace";
**** On Primary ****
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (1),(2),(3);
SELECT * FROM t1;
a
1
2
3
REPLACE INTO t1 VALUES (4);
SELECT * FROM t1;
a
1
2
3
4
call mtr.add_suppression("Replica SQL.*The incident LOST_EVENTS occured on the primary.* 1590");
include/wait_for_replica_sql_error.inc [errno=1590]
Last_SQL_Error = 'The incident LOST_EVENTS occured on the primary. Message: <none>'
**** On Replica ****
SELECT * FROM t1;
a
1
2
3
SET GLOBAL SQL_REPLICA_SKIP_COUNTER=1;
START REPLICA;
SELECT * FROM t1;
a
1
2
3
4
include/check_replica_is_running.inc
DROP TABLE t1;
SET GLOBAL DEBUG= @old_debug;
include/rpl_end.inc
