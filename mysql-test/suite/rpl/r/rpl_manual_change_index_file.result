include/primary-replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection primary]
FLUSH LOGS;
CREATE TABLE t1(c1 INT);
include/sync_replica_sql_with_primary.inc
FLUSH LOGS;
call mtr.add_suppression('Got fatal error 1236 from primary when reading data from binary log: .*could not find next log');
include/wait_for_replica_io_error.inc [errno=1236]
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
Last_IO_Error = 'Got fatal error 1236 from primary when reading data from binary log: 'could not find next log; the first event '' at XXX, the last event read from './primary-bin.000002' at XXX, the last byte read from './primary-bin.000002' at XXX.''
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
CREATE TABLE t2(c1 INT);
FLUSH LOGS;
CREATE TABLE t3(c1 INT);
FLUSH LOGS;
CREATE TABLE t4(c1 INT);
START REPLICA IO_THREAD;
include/wait_for_replica_io_to_start.inc
include/sync_replica_sql_with_primary.inc
SHOW TABLES;
Tables_in_test
t1
t2
t3
t4
DROP TABLE t1, t2, t3, t4;
include/sync_replica_sql_with_primary.inc

# BUG#21437 server_errno=29 error message flood mysqld error log
# --------------------------------------------------------------------------
# This test verifies if the ER_PRIMARY_FATAL_ERROR_READING_BINLOG which
# insteads of EE_FILENOTFOUND error is sent to replica, so that the replica
# I/O thread stops immediately.
include/rpl_reset.inc
[ on primary ]
call mtr.add_suppression("Got fatal error 1236 from primary when reading data from binary log:");
CREATE TABLE t1(c1 int);
DROP TABLE t1;
FLUSH LOGS;
CREATE TABLE t2(c1 int);
DROP TABLE t2;
include/sync_replica_sql_with_primary.inc
[ on replica ]
include/stop_replica.inc
[ on primary ]
# This operation will result in error EE_FILENOTFOUND which happens
# when replica IO thread is connecting to primary.
[ on replica ]
CHANGE PRIMARY TO primary_host='127.0.0.1', primary_log_file='primary-bin.000001';
Warnings:
Warning	3023	CHANGE PRIMARY TO with a PRIMARY_LOG_FILE clause but no PRIMARY_LOG_POS clause may not be safe. The old position value may not be valid for the new binary log file.
START REPLICA IO_THREAD;
# Instead of EE_FILENOTFOUND, ER_PRIMARY_FATAL_ERROR_READING_BINLOG
# and the specific information are sent to replica.
include/wait_for_replica_io_error.inc [errno=1236]
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
Last_IO_Error = 'Got fatal error 1236 from primary when reading data from binary log: 'Could not open log file''
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
[ on primary ]
# Restore primary-bin.000001 file
[ on replica ]
CHANGE PRIMARY TO primary_host='127.0.0.1', primary_log_file='primary-bin.000002';
Warnings:
Warning	3023	CHANGE PRIMARY TO with a PRIMARY_LOG_FILE clause but no PRIMARY_LOG_POS clause may not be safe. The old position value may not be valid for the new binary log file.
include/start_replica.inc
[ on primary ]
CREATE TABLE t1(c1 INT);
include/sync_replica_sql_with_primary.inc
[ on replica ]
SELECT * FROM t1;
c1
DROP TABLE t1;
include/rpl_end.inc
