include/primary-replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection primary]
#
# Create a new channel from the replica to the third server.
#  There shall be an error
[connection server_2]
CHANGE PRIMARY TO PRIMARY_HOST = "127.0.0.1", PRIMARY_PORT = PRIMARY_PORT FOR CHANNEL "channel_3";;
ERROR HY000: To have multiple channels, repository cannot be of type FILE; Please check the repository configuration and convert them to TABLE.
#  Convert only primary_info_repository to table.
#  The same error shall persist
include/stop_replica.inc
SET @@GLOBAL.primary_info_repository ="TABLE";
call mtr.add_suppression("Replica: Cannot create new primary info structure when repositories are of type FILE. Convert replica repositories  to TABLE to replicate from multiple sources");
CHANGE PRIMARY TO PRIMARY_HOST = "127.0.0.1", PRIMARY_USER = "root", PRIMARY_PORT = PRIMARY_PORT FOR CHANNEL "channel_3";;
ERROR HY000: To have multiple channels, repository cannot be of type FILE; Please check the repository configuration and convert them to TABLE.
#  Convert only relay log info repository to TABLE
#  The same error shall remain
SET @@GLOBAL.primary_info_repository = "FILE";
SET @@GLOBAL.relay_log_info_repository = "TABLE";
CHANGE PRIMARY TO PRIMARY_HOST = "127.0.0.1", PRIMARY_USER = "root", PRIMARY_PORT = PRIMARY_PORT FOR CHANNEL "channel_3";;
ERROR HY000: To have multiple channels, repository cannot be of type FILE; Please check the repository configuration and convert them to TABLE.
#
# Convert both repositories to TABLE. CHANGE PRIMARY command passes
#
SET @@GLOBAL.primary_info_repository = "TABLE";
CHANGE PRIMARY TO PRIMARY_HOST ="127.0.0.1", PRIMARY_USER ="root", PRIMARY_PORT=PRIMARY_PORT FOR CHANNEL "channel_3";
Warnings:
Note	#	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	#	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
# Replica now is a multisourced replica.
# Restart the replica and check that replica threads are not started because
# the repositories are of type FILE
call mtr.add_suppression("Replica: This replica was a multisourced replica previously*");
call mtr.add_suppression("Failed to create or recover replication info repositories");
include/rpl_restart_server.inc [server_number=2]
SHOW REPLICA STATUS;
include/assert.inc [there shall be only 0 rows as the replica is not configured.]
#
#   Test that if replica server is started with TABLE, replication proceeds
#   as usual.
include/rpl_restart_server.inc [server_number=2 parameters: --primary-info-repository=TABLE --relay-log-info-repository=TABLE]
include/assert.inc [there shall be only 2 rows as replica is restarted properly]
#
#   Set replica repostiories to FILE. An error is generated.
#
SET @@GLOBAL.primary_info_repository = "FILE";
ERROR HY000: Failure while changing the type of replication repository: Repository conversion is possible when only default channel exists.
SET @@GLOBAL.relay_log_info_repository = "FILE";
ERROR HY000: Failure while changing the type of replication repository: Repository conversion is possible when only default channel exists.
SHOW VARIABLES LIKE '%info_repository%';
Variable_name	Value
primary_info_repository	TABLE
relay_log_info_repository	TABLE
#
#  Currently replica repositores are of type TABLE. Try again
#  again setting to TABLE. Returns success doing nothing.
#
SET @@GLOBAL.primary_info_repository = "TABLE";
SET @@GLOBAL.relay_log_info_repository = "TABLE";
include/stop_replica.inc
Warnings:
Note	3084	Replication thread(s) for channel 'channel_3' are already stopped.
RESET REPLICA ALL FOR CHANNEL 'channel_3';
include/rpl_restart_server.inc [server_number=2 parameters: --primary-info-repository=FILE --relay-log-info-repository=FILE]
include/rpl_end.inc
