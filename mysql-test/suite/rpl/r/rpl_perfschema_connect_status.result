include/primary-replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection primary]
include/assert.inc [On primary, the table should return an empty set.]
include/assert.inc [On replica, the group_name should be set NULL]

# Verify that SELECT works for every field and produces an output similar
# to the corresponding field in SHOW REPLICA STATUS(SSS). To verify the
# correctness of thread_id field, we check for the name of the thread.

include/assert.inc [Value returned by SSS and PS table for Source_UUID should be same.]
include/assert.inc [thread_name should should indicate io thread.]
include/assert.inc [SSS shows Replica_IO_Running as "Yes". So, Service_State from this PS table should be "ON".]
include/assert.inc [IS and PS tables should both show that no heartbeats have been received.]
include/assert.inc [IS table should give an empty output and PS table should output 0000-00-00 00:00:00 both indicating no heartbeats have been received]
include/assert.inc [Value returned by SSS and PS table for Received_Transaction_Set should be same.]
include/assert.inc [Value returned by SSS and PS table for Last_Error_Number should be same.]
include/assert.inc [Value returned by SSS and PS table for Last_Error_Message should be same.]
include/assert.inc [Value returned by PS table for Last_Error_Timestamp should be 0000-00-00 00:00:00.]
include/stop_replica.inc

# heartbeat count and last heartbeat timestamp are indeterministic so we
# can not test for their exact values. We will thus check for >0 number
# of heartbeats and last heartbeat timestamp!= zeros.

change primary to primary_heartbeat_period= 0.5;
set @restore_replica_net_timeout= @@global.replica_net_timeout;
set @@global.replica_net_timeout= 10;
include/start_replica.inc

A heartbeat has been received by the replica

include/assert.inc [last_heartbeat_timestamp should NOT be zero]
set @@global.replica_net_timeout= @restore_replica_net_timeout;

# We now introduce an error in the IO thread and check for the correctness
# of error number, message and timestamp fields.

include/stop_replica.inc
change primary to
primary_user='replssl',
primary_password='';
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
start replica io_thread;
include/wait_for_replica_param.inc [Last_IO_Errno]

# Extract the error related fields from SSS and PS table and compare
# them for correctness.

include/assert.inc [Value returned by SSS and PS table for Last_Error_Number should be same.]
Value returned by SSS and PS table for Last_Error_Message is same.
include/assert.inc [Value returned by SSS and PS table for Last_Error_Timestamp should be same.]

# Verify that source_UUID and the error related fields are preserved
# after STOP REPLICA, thread_id changes to NULL and service_state to "off".

include/stop_replica.inc

# 1. Verify that thread_id changes to NULL and service_state to "off" on
#    STOP REPLICA.

include/assert.inc [After STOP REPLICA, thread_id should be NULL]
include/assert.inc [SSS shows Replica_IO_Running as "No". So, Service_State from this PS table should be "OFF".]

# 2. Extract the source_UUID and the error related fields from SSS and PS
#    table and compare them. These fields should preserve their values.

include/assert.inc [Value returned by SSS and PS table for Source_UUID should be same.]
include/assert.inc [Value returned by SSS and PS table for Last_Error_Number should be same.]
Value returned by SSS and PS table for Last_Error_Message is same.
include/assert.inc [Value returned by SSS and PS table for Last_Error_Timestamp should be same.]

# Restart the primary and replica servers in gtid-mode=on, execute some
# transactions and verify the 'Received_Transaction_Set' field.

include/rpl_restart_server.inc [server_number=1 gtids=on]
include/rpl_restart_server.inc [server_number=2 gtids=on]
change primary to
primary_user = 'root',
primary_auto_position= 1;
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
include/start_replica.inc
use test;
create table t(a int);
insert into t values(1);
include/sync_replica_sql_with_primary.inc
include/assert.inc [Value returned by SSS and PS table for Received_Transaction_Set should be same.]

# Verify that the value for 'Received_Transaction_Set' field is preserved
# after STOP REPLICA.

include/stop_replica.inc
include/assert.inc [Received_Transaction_Set should not have changed after STOP REPLICA]

# Verify that the value for 'Received_Transaction_Set' is cleared
# after RESET REPLICA.

RESET REPLICA;
include/assert.inc [Received_Transaction_Set should be empty after RESET REPLICA]
include/start_replica.inc
include/rpl_end.inc
