include/primary-replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection primary]
# Initial setup
[connection primary]
CREATE TABLE t1 (c1 INT) ENGINE=InnoDB;
# Sync replica with primary and setup debug sync point
include/sync_replica_sql_with_primary.inc
SET @save_debug=@@global.debug;
SET GLOBAL DEBUG='d,stop_io_after_reading_write_rows_log_event';
# Insert the data in the primary
[connection primary]
BEGIN;
INSERT INTO t1 (c1) VALUES (0);
INSERT INTO t1 (c1) VALUES (1);
COMMIT;
# Restart the IO thread keeping SQL thread running until last relay log split
[connection replica]
include/wait_for_replica_io_to_stop.inc
START REPLICA IO_THREAD;
include/wait_for_replica_io_to_stop.inc
# Stop the SQL thread (it should be in the middle of the transaction/group)
include/stop_replica_sql.inc
# Remove the debug point and restart the both threads
SET GLOBAL DEBUG= @save_debug;
include/start_replica.inc
# Do one more insert on primary and then sync replica with primary
[connection primary]
INSERT INTO t1 (c1) VALUES (2);
include/sync_replica_sql_with_primary.inc
# Now compare primary and replica's t1 table data
[connection primary]
include/diff_tables.inc [primary:t1, replica:t1]
# Cleanup
[connection primary]
DROP TABLE t1;
include/rpl_end.inc
