include/primary-replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection primary]
call mtr.add_suppression("Replica: Can\'t find record in \'t\' Error_code: 1032");
call mtr.add_suppression("Replica SQL for channel '': .*Could not execute Update_rows event on table test.t; Can.t find record in .t.* Error_code: 1032");
call mtr.add_suppression("The replica coordinator and worker threads are stopped, possibly leaving data in inconsistent state");
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	FULL
SET @old_binlog_row_image= @@binlog_row_image;
SET @old_binlog_row_image= @@binlog_row_image;
#####################################################
# basic assertion that binlog_row_image='FULL' is the
# default 
#####################################################
CON: 'primary', IMG: 'FULL', RESTART REPLICA: 'N'
SET SESSION binlog_row_image= 'FULL';
SET GLOBAL binlog_row_image= 'FULL';
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	FULL
CON: 'replica', IMG: 'FULL', RESTART REPLICA: 'Y'
SET SESSION binlog_row_image= 'FULL';
SET GLOBAL binlog_row_image= 'FULL';
include/stop_replica.inc
include/start_replica.inc
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	FULL
CREATE TABLE t (c1 int, c2 int, c3 blob, primary key(c1));
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (1, 'a');
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c1=2 WHERE c1=1;;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t;;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
SET @img_types= 'MINIMAL NOBLOB FULL';
CON: 'primary', IMG: 'MINIMAL', RESTART REPLICA: 'N'
Variable_name	Value
binlog_row_image	MINIMAL
CON: 'replica', IMG: 'MINIMAL', RESTART REPLICA: 'Y'
include/stop_replica.inc
include/start_replica.inc
Variable_name	Value
binlog_row_image	MINIMAL
ITERATIONS: row_img: MINIMAL, indexes: UK-NOT-NULL
include/rpl_reset.inc
CREATING TABLE IN primary WITH INDEX 'UK-NOT-NULL'
CREATE TABLE t (c1 int NOT NULL, c2 int, c3 blob, unique key(c1));
include/sync_replica_sql_with_primary.inc
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1,2,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (10,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1000);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c1=2 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
ITERATIONS: row_img: MINIMAL, indexes: PK
include/rpl_reset.inc
CREATING TABLE IN primary WITH INDEX 'PK'
CREATE TABLE t (c1 int, c2 int, c3 blob, primary key(c1));
include/sync_replica_sql_with_primary.inc
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1,2,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (10,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1000);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c1=2 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
ITERATIONS: row_img: MINIMAL, indexes: UK
include/rpl_reset.inc
CREATING TABLE IN primary WITH INDEX 'UK'
CREATE TABLE t (c1 int, c2 int, c3 blob, unique key(c1));
include/sync_replica_sql_with_primary.inc
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1,2,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (10,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1000);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c1=2 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
ITERATIONS: row_img: MINIMAL, indexes: K
include/rpl_reset.inc
CREATING TABLE IN primary WITH INDEX 'K'
CREATE TABLE t (c1 int, c2 int, c3 blob, key(c1));
include/sync_replica_sql_with_primary.inc
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1,2,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (10,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1000);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c1=2 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
ITERATIONS: row_img: MINIMAL, indexes: NONE
include/rpl_reset.inc
CREATING TABLE IN primary WITH INDEX 'NONE'
CREATE TABLE t (c1 int, c2 int, c3 blob);
include/sync_replica_sql_with_primary.inc
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1,2,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (10,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1000);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c1=2 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
CON: 'primary', IMG: 'NOBLOB', RESTART REPLICA: 'N'
Variable_name	Value
binlog_row_image	NOBLOB
CON: 'replica', IMG: 'NOBLOB', RESTART REPLICA: 'Y'
include/stop_replica.inc
include/start_replica.inc
Variable_name	Value
binlog_row_image	NOBLOB
ITERATIONS: row_img: NOBLOB, indexes: UK-NOT-NULL
include/rpl_reset.inc
CREATING TABLE IN primary WITH INDEX 'UK-NOT-NULL'
CREATE TABLE t (c1 int NOT NULL, c2 int, c3 blob, unique key(c1));
include/sync_replica_sql_with_primary.inc
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1,2,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (10,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1000);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c1=2 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
ITERATIONS: row_img: NOBLOB, indexes: PK
include/rpl_reset.inc
CREATING TABLE IN primary WITH INDEX 'PK'
CREATE TABLE t (c1 int, c2 int, c3 blob, primary key(c1));
include/sync_replica_sql_with_primary.inc
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1,2,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (10,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1000);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c1=2 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
ITERATIONS: row_img: NOBLOB, indexes: UK
include/rpl_reset.inc
CREATING TABLE IN primary WITH INDEX 'UK'
CREATE TABLE t (c1 int, c2 int, c3 blob, unique key(c1));
include/sync_replica_sql_with_primary.inc
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1,2,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (10,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1000);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c1=2 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
ITERATIONS: row_img: NOBLOB, indexes: K
include/rpl_reset.inc
CREATING TABLE IN primary WITH INDEX 'K'
CREATE TABLE t (c1 int, c2 int, c3 blob, key(c1));
include/sync_replica_sql_with_primary.inc
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1,2,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (10,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1000);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c1=2 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
ITERATIONS: row_img: NOBLOB, indexes: NONE
include/rpl_reset.inc
CREATING TABLE IN primary WITH INDEX 'NONE'
CREATE TABLE t (c1 int, c2 int, c3 blob);
include/sync_replica_sql_with_primary.inc
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1,2,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (10,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1000);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c1=2 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
CON: 'primary', IMG: 'FULL', RESTART REPLICA: 'N'
Variable_name	Value
binlog_row_image	FULL
CON: 'replica', IMG: 'FULL', RESTART REPLICA: 'Y'
include/stop_replica.inc
include/start_replica.inc
Variable_name	Value
binlog_row_image	FULL
ITERATIONS: row_img: FULL, indexes: UK-NOT-NULL
include/rpl_reset.inc
CREATING TABLE IN primary WITH INDEX 'UK-NOT-NULL'
CREATE TABLE t (c1 int NOT NULL, c2 int, c3 blob, unique key(c1));
include/sync_replica_sql_with_primary.inc
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1,2,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (10,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1000);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c1=2 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
ITERATIONS: row_img: FULL, indexes: PK
include/rpl_reset.inc
CREATING TABLE IN primary WITH INDEX 'PK'
CREATE TABLE t (c1 int, c2 int, c3 blob, primary key(c1));
include/sync_replica_sql_with_primary.inc
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1,2,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (10,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1000);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c1=2 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
ITERATIONS: row_img: FULL, indexes: UK
include/rpl_reset.inc
CREATING TABLE IN primary WITH INDEX 'UK'
CREATE TABLE t (c1 int, c2 int, c3 blob, unique key(c1));
include/sync_replica_sql_with_primary.inc
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1,2,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (10,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1000);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c1=2 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
ITERATIONS: row_img: FULL, indexes: K
include/rpl_reset.inc
CREATING TABLE IN primary WITH INDEX 'K'
CREATE TABLE t (c1 int, c2 int, c3 blob, key(c1));
include/sync_replica_sql_with_primary.inc
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1,2,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (10,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1000);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c1=2 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
ITERATIONS: row_img: FULL, indexes: NONE
include/rpl_reset.inc
CREATING TABLE IN primary WITH INDEX 'NONE'
CREATE TABLE t (c1 int, c2 int, c3 blob);
include/sync_replica_sql_with_primary.inc
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1,2,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (10,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1000);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c1=2 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
SET @img_types= 'MINIMAL NOBLOB FULL';
CON: 'primary', IMG: 'MINIMAL', RESTART REPLICA: 'N'
Variable_name	Value
binlog_row_image	MINIMAL
CON: 'replica', IMG: 'MINIMAL', RESTART REPLICA: 'Y'
include/stop_replica.inc
include/start_replica.inc
Variable_name	Value
binlog_row_image	MINIMAL
ITERATIONS: row_img: MINIMAL
include/rpl_reset.inc
include/sync_replica_sql_with_primary.inc
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
include/sync_replica_sql_with_primary.inc
include/rpl_reset.inc
####### MINIMAL PARTICULAR SCENARIO ######
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
include/sync_replica_sql_with_primary.inc
####### MINIMAL OTHER PARTICULAR SCENARIO ######
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
include/sync_replica_sql_with_primary.inc
CON: 'primary', IMG: 'NOBLOB', RESTART REPLICA: 'N'
Variable_name	Value
binlog_row_image	NOBLOB
CON: 'replica', IMG: 'NOBLOB', RESTART REPLICA: 'Y'
include/stop_replica.inc
include/start_replica.inc
Variable_name	Value
binlog_row_image	NOBLOB
ITERATIONS: row_img: NOBLOB
include/rpl_reset.inc
include/sync_replica_sql_with_primary.inc
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
include/sync_replica_sql_with_primary.inc
include/rpl_reset.inc
####### NOBLOB PARTICULAR SCENARIO ######
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
include/sync_replica_sql_with_primary.inc
CON: 'primary', IMG: 'FULL', RESTART REPLICA: 'N'
Variable_name	Value
binlog_row_image	FULL
CON: 'replica', IMG: 'FULL', RESTART REPLICA: 'Y'
include/stop_replica.inc
include/start_replica.inc
Variable_name	Value
binlog_row_image	FULL
ITERATIONS: row_img: FULL
include/rpl_reset.inc
include/sync_replica_sql_with_primary.inc
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
include/sync_replica_sql_with_primary.inc
include/rpl_reset.inc
################## SPECIAL CASES #########################
include/rpl_reset.inc
CON: 'primary', IMG: 'NOBLOB', RESTART REPLICA: 'N'
SET SESSION binlog_row_image= 'NOBLOB';
SET GLOBAL binlog_row_image= 'NOBLOB';
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	NOBLOB
CON: 'replica', IMG: 'NOBLOB', RESTART REPLICA: 'Y'
SET SESSION binlog_row_image= 'NOBLOB';
SET GLOBAL binlog_row_image= 'NOBLOB';
include/stop_replica.inc
include/start_replica.inc
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	NOBLOB
###################################
# PK (contains blob)
###################################
CREATE TABLE t (c1 int, c2 int, c3 blob, primary key(c1,c3(512)));
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1,2,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (10,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1000);
Warnings:
Warning	1364	Field 'c3' doesn't have a default value
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c1=2 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
###################################
# PK (does not contain blob, but blob is updated)
###################################
include/rpl_reset.inc
CREATE TABLE t (c1 int, c2 int, c3 blob, primary key(c1,c2));
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1,2,"a");
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1,c3) VALUES (10,"a");
Warnings:
Warning	1364	Field 'c2' doesn't have a default value
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1000);
Warnings:
Warning	1364	Field 'c2' doesn't have a default value
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c3='b' WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
###################################
# AUTOINC columns
###################################
include/rpl_reset.inc
CON: 'primary', IMG: 'MINIMAL', RESTART REPLICA: 'N'
SET SESSION binlog_row_image= 'MINIMAL';
SET GLOBAL binlog_row_image= 'MINIMAL';
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	MINIMAL
CON: 'replica', IMG: 'MINIMAL', RESTART REPLICA: 'Y'
SET SESSION binlog_row_image= 'MINIMAL';
SET GLOBAL binlog_row_image= 'MINIMAL';
include/stop_replica.inc
include/start_replica.inc
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	MINIMAL
CREATE TABLE t (c1 int NOT NULL AUTO_INCREMENT, c2 int, c3 blob, primary key(c1,c2));
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c2) VALUES (2);
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
##################################################################
# Test that replica does not write more columns than the ones it has 
##################################################################
include/rpl_reset.inc
CON: 'primary', IMG: 'MINIMAL', RESTART REPLICA: 'N'
SET SESSION binlog_row_image= 'MINIMAL';
SET GLOBAL binlog_row_image= 'MINIMAL';
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	MINIMAL
CON: 'replica', IMG: 'MINIMAL', RESTART REPLICA: 'Y'
SET SESSION binlog_row_image= 'MINIMAL';
SET GLOBAL binlog_row_image= 'MINIMAL';
include/stop_replica.inc
include/start_replica.inc
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	MINIMAL
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int NOT NULL AUTO_INCREMENT, c2 int, c3 blob, primary key(c1,c2));
SET SQL_LOG_BIN=1;
CREATE TABLE t (c1 int, c2 int, primary key(c1));
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c2,c3) VALUES (2,'aaaaa');
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c2=3, c3='bbbbb' WHERE c2=2;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
##################################################################
# Test that replica fills default columns in its own columns
##################################################################
include/rpl_reset.inc
CON: 'primary', IMG: 'FULL', RESTART REPLICA: 'N'
SET SESSION binlog_row_image= 'FULL';
SET GLOBAL binlog_row_image= 'FULL';
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	FULL
CON: 'replica', IMG: 'FULL', RESTART REPLICA: 'Y'
SET SESSION binlog_row_image= 'FULL';
SET GLOBAL binlog_row_image= 'FULL';
include/stop_replica.inc
include/start_replica.inc
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	FULL
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int, c2 int);
SET SQL_LOG_BIN=1;
CREATE TABLE t (c1 int, c2 int, c3 int DEFAULT 2005);
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (1);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t(c1) VALUES (2);
SET sql_mode = default;
SELECT * FROM t;
c1	c2	c3
1	NULL	2005
2	NULL	2005
SELECT * FROM t;
c1	c2
1	NULL
2	NULL
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
##################################################################
# Test that replica uses partial BI when primary contains more columns
##################################################################
include/rpl_reset.inc
CON: 'primary', IMG: 'MINIMAL', RESTART REPLICA: 'N'
SET SESSION binlog_row_image= 'MINIMAL';
SET GLOBAL binlog_row_image= 'MINIMAL';
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	MINIMAL
CON: 'replica', IMG: 'MINIMAL', RESTART REPLICA: 'Y'
SET SESSION binlog_row_image= 'MINIMAL';
SET GLOBAL binlog_row_image= 'MINIMAL';
include/stop_replica.inc
include/start_replica.inc
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	MINIMAL
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int NOT NULL, c2 int, c3 int, primary key(c1, c3), unique key(c1));
SET SQL_LOG_BIN=1;
CREATE TABLE t (c1 int NOT NULL, c2 int, unique key(c1));
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1, 2, 3);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c2= 4 WHERE c1=1;
SET sql_mode = default;
SELECT * FROM t;
c1	c2
1	4
SELECT * FROM t;
c1	c2	c3
1	4	3
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
##################################################################
# Test that if primary has binlog_row_image=MINIMAL and replica has 
# NOBLOB or FULL, it will log the expected columns
##################################################################
include/rpl_reset.inc
CON: 'primary', IMG: 'MINIMAL', RESTART REPLICA: 'N'
SET SESSION binlog_row_image= 'MINIMAL';
SET GLOBAL binlog_row_image= 'MINIMAL';
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	MINIMAL
CON: 'replica', IMG: 'FULL', RESTART REPLICA: 'Y'
SET SESSION binlog_row_image= 'FULL';
SET GLOBAL binlog_row_image= 'FULL';
include/stop_replica.inc
include/start_replica.inc
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	FULL
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int NOT NULL, c2 int, c3 int, primary key(c1));
SET SQL_LOG_BIN=1;
CREATE TABLE t (c1 int NOT NULL, c2 int, c3 int, c4 blob, unique key(c1));
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1, 2, 3);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c2= 4 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=4;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
include/rpl_reset.inc
CON: 'primary', IMG: 'MINIMAL', RESTART REPLICA: 'N'
SET SESSION binlog_row_image= 'MINIMAL';
SET GLOBAL binlog_row_image= 'MINIMAL';
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	MINIMAL
CON: 'replica', IMG: 'NOBLOB', RESTART REPLICA: 'Y'
SET SESSION binlog_row_image= 'NOBLOB';
SET GLOBAL binlog_row_image= 'NOBLOB';
include/stop_replica.inc
include/start_replica.inc
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	NOBLOB
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int NOT NULL, c2 int, c3 int, primary key(c1));
SET SQL_LOG_BIN=1;
CREATE TABLE t (c1 int NOT NULL, c2 int, c3 int, c4 blob, unique key(c1));
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
INSERT INTO t VALUES (1, 2, 3);
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
UPDATE t SET c2= 4 WHERE c1=1;
SET sql_mode = default;
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
DELETE FROM t WHERE c2=4;
SET sql_mode = default;
DROP TABLE t;
include/sync_replica_sql_with_primary.inc
################################################################
# Test that the replica stop with error if no usable data is on BI
################################################################
include/rpl_reset.inc
CON: 'primary', IMG: 'MINIMAL', RESTART REPLICA: 'N'
SET SESSION binlog_row_image= 'MINIMAL';
SET GLOBAL binlog_row_image= 'MINIMAL';
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	MINIMAL
CON: 'replica', IMG: 'NOBLOB', RESTART REPLICA: 'Y'
SET SESSION binlog_row_image= 'NOBLOB';
SET GLOBAL binlog_row_image= 'NOBLOB';
include/stop_replica.inc
include/start_replica.inc
FLUSH TABLES;
SHOW VARIABLES LIKE 'binlog_row_image';
Variable_name	Value
binlog_row_image	NOBLOB
SET SQL_LOG_BIN=0;
CREATE TABLE t (c1 int NOT NULL, c2 int, c3 int, primary key(c3));
SET SQL_LOG_BIN=1;
CREATE TABLE t (c1 int NOT NULL, c2 int, primary key(c1));
INSERT INTO t VALUES (1,2,3);
UPDATE t SET c2=4 WHERE c2=2;
DROP TABLE t;
include/wait_for_replica_sql_error.inc [errno=1032]
DROP TABLE t;
include/rpl_reset.inc
SET GLOBAL binlog_row_image= @old_binlog_row_image;
SET SESSION binlog_row_image= @old_binlog_row_image;
SET GLOBAL binlog_row_image= @old_binlog_row_image;
SET SESSION binlog_row_image= @old_binlog_row_image;
include/rpl_end.inc
