include/primary-replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection primary]
==== Create new replication user ====
[on primary]
CREATE USER rpluser_with_length_32_123456789@127.0.0.1 IDENTIFIED BY 'rpl';
CREATE USER rpluser_with_length_32_1234567890@127.0.0.1 IDENTIFIED BY 'rpl';
ERROR HY000: String 'rpluser_with_length_32_1234567890' is too long for user name (should be no longer than 32)
GRANT REPLICATION REPLICA ON *.* TO rpluser_with_length_32_123456789@127.0.0.1;
[on replica]
include/sync_replica_sql_with_primary.inc
include/stop_replica.inc
CHANGE PRIMARY TO primary_user='rpluser_with_length_32_123456789', primary_password='rpl';
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
include/start_replica.inc
==== Do replication as new user ====
[on primary]
CREATE TABLE t1 (n INT);
INSERT INTO t1 VALUES (1);
[on replica]
include/sync_replica_sql_with_primary.inc
SELECT * FROM t1;
n
1
==== Delete new replication user ====
[on primary]
DROP USER rpluser_with_length_32_123456789@127.0.0.1;
FLUSH PRIVILEGES;
[on replica]
include/sync_replica_sql_with_primary.inc
==== Restart replica without privileges =====
include/stop_replica.inc
START REPLICA;
include/wait_for_replica_sql_to_start.inc
include/wait_for_replica_io_to_stop.inc
==== Verify that Replica IO thread stopped with error ====
include/wait_for_replica_io_error.inc [errno=1045]
==== Cleanup (Note that replica IO thread is not running) ====
include/stop_replica_sql.inc
CHANGE PRIMARY TO PRIMARY_USER = 'root', PRIMARY_PASSWORD = '';
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
include/rpl_reset.inc
[on primary]
DROP TABLE t1;
include/rpl_end.inc
