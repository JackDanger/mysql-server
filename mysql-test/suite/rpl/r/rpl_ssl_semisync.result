include/primary-replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection primary]
include/install_semisync.inc
call mtr.add_suppression(".*Semi-sync primary failed on net_flush.*before waiting for replica reply.*");
call mtr.add_suppression(".*Timeout waiting for reply of binlog .* semi-sync up to file .*");
include/sync_replica_sql_with_primary.inc
[connection replica]
include/stop_replica.inc
CHANGE PRIMARY TO PRIMARY_SSL = 1;
include/start_replica.inc

# Try replicating CREATE TABLE and verify that everything is fine.

[connection primary]
USE test;
CREATE TABLE table1 (a INT);
include/sync_replica_sql_with_primary.inc

# STOP REPLICA and verify that replication works fine when replica resumes.

include/stop_replica_io.inc
[connection primary]
INSERT INTO table1 VALUES(1);
[connection replica]
include/start_replica_io.inc

# RE-START REPLICA and execute on primary, verify that replication works fine.

[connection primary]
INSERT INTO table1 VALUES(2);
include/sync_replica_sql_with_primary.inc
include/assert.inc [Replica should have 2 rows(1,2)]

# Clean-up

[connection primary]
DROP TABLE table1;
include/sync_replica_sql_with_primary.inc
include/uninstall_semisync.inc
include/stop_replica.inc
CHANGE PRIMARY TO PRIMARY_SSL = 0;
include/rpl_end.inc
