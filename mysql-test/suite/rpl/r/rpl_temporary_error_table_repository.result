include/primary-replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the primary info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection primary]
[connection primary]
CREATE TABLE t1 (c1 INT PRIMARY KEY, c2 INT) ENGINE= InnoDB;
include/stop_replica.inc
SET @saved_replica_transaction_retries = @@GLOBAL.replica_transaction_retries;
SET @saved_innodb_lock_wait_timeout = @@GLOBAL.innodb_lock_wait_timeout;
SET @saved_primary_info_repository = @@GLOBAL.primary_info_repository;
SET @saved_relay_log_info_repository = @@GLOBAL.relay_log_info_repository;
SET @@GLOBAL.innodb_lock_wait_timeout = 1;
SET @@GLOBAL.primary_info_repository = TYPE;
SET @@GLOBAL.relay_log_info_repository = TYPE;
[connection replica1]
BEGIN;
INSERT INTO t1 VALUES (7,0);
[connection primary]
INSERT INTO t1 VALUES (7,7);
[connection replica]
SET @@GLOBAL.replica_transaction_retries = 0;
include/start_replica.inc
### Specified retry number is expected ###
### Timeout error is expected ###
include/wait_for_replica_sql_error.inc [errno=1205]
[connection replica]
SET @@GLOBAL.replica_transaction_retries = 1;
include/start_replica.inc
### Specified retry number is expected ###
### Timeout error is expected ###
include/wait_for_replica_sql_error.inc [errno=1205]
[connection replica1]
ROLLBACK;
#### Cleanup ####
[connection replica]
include/stop_replica.inc
SET @@GLOBAL.replica_transaction_retries = @saved_replica_transaction_retries;
SET @@GLOBAL.primary_info_repository = @saved_primary_info_repository;
SET @@GLOBAL.relay_log_info_repository = @saved_relay_log_info_repository;
SET @@GLOBAL.innodb_lock_wait_timeout = @saved_innodb_lock_wait_timeout ;
include/start_replica.inc
[connection primary]
DROP TABLE t1;
include/rpl_end.inc
