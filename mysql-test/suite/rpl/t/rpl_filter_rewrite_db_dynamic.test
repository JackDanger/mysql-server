#
# Test if dynamic replication database filter rules are properly evaluated.
#

source include/have_binlog_format_statement.inc;
source include/primary-replica.inc;

connection replica;
--error ER_REPLICA_SQL_THREAD_MUST_STOP
CHANGE REPLICATION FILTER REPLICATE_REWRITE_DB=((db1,db2));

connection replica;
source include/stop_replica.inc;
CHANGE REPLICATION FILTER REPLICATE_REWRITE_DB=((db1,db2));
source include/start_replica.inc;
connection primary;

CREATE DATABASE db1;
CREATE DATABASE db2;

USE db1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 values (12);

--source include/sync_replica_sql_with_primary.inc

# Just prove that there is no db1.t1 at replica after sync
--error ER_NO_SUCH_TABLE
SELECT * from db1.t1;
# And check that db1.t1 data is replicated as db2.t1's data.
--let $diff_tables=primary:db1.t1, replica:db2.t1
--source include/diff_tables.inc

# Clean up
connection primary;
DROP DATABASE db1;
DROP DATABASE db2;

--source include/rpl_end.inc

connection replica;
CHANGE REPLICATION FILTER REPLICATE_REWRITE_DB=();
