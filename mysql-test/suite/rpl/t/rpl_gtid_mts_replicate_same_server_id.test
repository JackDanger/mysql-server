# ==== Purpose ====
#
# Verify that --replicate-same-server-id works with GTID_MODE=ON and
# MTS.
#
# ==== Implementation ====
#
# The main implementation is in the .opt file: it sets up primary and
# replica with MTS enabled and with replicate-same-server-id enabled.
# The test case just checks that it works to replicate a couple of
# simple statements in this scenario. This test does not actually use
# the same server_id on primary and replica.
#
# ==== References ====
#
# BUG#18967791 REPLICA THREAD FAILS WITH MTS + GTID + REPLICATE_SAME_SERVER_ID
#   Prior to this bug, the MTS replica would fail when reading
#   Previous_gtids_log_event.  This only happened when
#   replicate-same-server-id was enabled because any
#   Previous_gtids_log_event in the relay log is generated by the
#   replica and has the replica's server_id.

--source include/not_group_replication_plugin.inc
--source include/have_gtid.inc
--let $use_gtids= 0
--source include/primary-replica.inc

CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (1);
--source include/sync_replica_sql_with_primary.inc

--let $assert_cond= a = 1 FROM t1
--let $assert_text= The two statements should have been replicated, so that t1 contains value 1.
--source include/assert.inc

--connection primary
DROP TABLE t1;

--source include/rpl_end.inc
