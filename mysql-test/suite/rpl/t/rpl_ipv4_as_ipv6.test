# Test of ipv4 (127.0.0.1) in ipv6 format, especially "change primary host=..."
# Options: --skip-name-resolve, --bind-address=0.0.0.0 (see corresponding cnf file)
# for primary and replica
#
--source include/have_ipv4_mapped.inc
--source include/have_log_bin.inc

let $IPv6= 127.0.0.1;
--echo #################### IP: $IPv6 ###########################
--source include/rpl_ipv6.inc

let $IPv6= 0:0:0:0:0:FFFF:127.0.0.1;
--echo #################### IP: $IPv6 ###########################
--source include/rpl_ipv6.inc

let $IPv6= 0000:0000:0000:0000:0000:FFFF:127.0.0.1;
--echo #################### IP: $IPv6 ###########################
--source include/rpl_ipv6.inc

let $IPv6= 0:0000:0000:0:0000:FFFF:127.0.0.1;
--echo #################### IP: $IPv6 ###########################
--source include/rpl_ipv6.inc

let $IPv6= 0::0000:FFFF:127.0.0.1;
--echo #################### IP: $IPv6 ###########################
--source include/rpl_ipv6.inc

#let $IPv6= 0:0:0:0:0:FFFF:127.0.0.1/96;
#--echo #################### IP: $IPv6 ###########################
#--source include/rpl_ipv6.inc

let $IPv6= ::FFFF:127.0.0.1;
--echo #################### IP: $IPv6 ###########################
--source include/rpl_ipv6.inc

#let $IPv6= ::FFFF:127.0.0.1/96;
#--echo #################### IP: $IPv6 ###########################
#--source include/rpl_ipv6.inc

let $IPv6= ::FFFF:127.0.0.1;
--echo #################### IP: $IPv6 ###########################
--echo connect (primary,127.0.0.1,root,,test,PRIMARY_MYPORT);
connect (primary,127.0.0.1,root,,test,$PRIMARY_MYPORT);
--echo connect (replica,127.0.0.1,root,,test,REPLICA_MYPORT);
connect (replica,127.0.0.1,root,,test,$REPLICA_MYPORT);
--echo connection primary;
connection primary;
reset primary;
source include/show_primary_status.inc;
save_primary_pos;
--echo connection replica;
connection replica;
reset replica;
let $primary_host= query_get_value(SHOW REPLICA STATUS, Primary_Host, 1);
--echo Primary-Host: $primary_host
eval change primary to primary_host='$IPv6';
let $primary_host= query_get_value(SHOW REPLICA STATUS, Primary_Host, 1);
--echo Primary-Host: $primary_host
eval change primary to primary_host='127.0.0.1';
let $primary_host= query_get_value(SHOW REPLICA STATUS, Primary_Host, 1);
--echo Primary-Host: $primary_host
eval change primary to primary_host='0:0000:0000:0:0000:FFFF:127.0.0.1';
let $primary_host= query_get_value(SHOW REPLICA STATUS, Primary_Host, 1);
--echo Primary-Host: $primary_host

# clean up
--replace_column 2 ####
CHANGE PRIMARY TO PRIMARY_HOST='127.0.0.1', PRIMARY_USER='root';
