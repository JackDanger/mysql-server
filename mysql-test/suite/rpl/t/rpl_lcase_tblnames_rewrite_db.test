# BUG#37656
#
# DESCRIPTION
#
#
#  This test case is tests whether replication works properly when
#  replica is configured with --lower-case-table-names=1 and replication
#  rewrite rules are in effect.
#
#  It checks four issues:
# 
#   (i) primary contains capitalized table name
#
#  (ii) replica contains lowered case table name
#
# (iii) primary and replica tables do not differ
#
--source include/not_group_replication_plugin.inc
-- source include/not_windows.inc
-- source include/not_lowercase1.inc
-- source include/primary-replica.inc

SET SQL_LOG_BIN=0;
CREATE DATABASE B37656;
SET SQL_LOG_BIN=1;

-- connection replica
CREATE DATABASE BUG37656;

-- echo ### action: show that database on replica is created in lowercase
SHOW DATABASES LIKE '%37656';

-- connection primary
USE B37656;
CREATE TABLE T1 (a int);
INSERT INTO T1 VALUES (1);

-- echo ### assertion: primary contains capitalized case table
# this fixes result mismatches for MacOSX
--replace_result Tables_in_b37656 Tables_in_B37656
SHOW TABLES;

--source include/sync_replica_sql_with_primary.inc

use bug37656;

-- echo ### assertion: replica contains lowered case table
SHOW TABLES;

-- echo ### assertion: primary and replica tables do not differ
-- let $diff_tables= primary:B37656.T1, replica:bug37656.t1
-- source include/diff_tables.inc

-- connection primary
SET SQL_LOG_BIN=0;
DROP DATABASE B37656;
SET SQL_LOG_BIN=1;
SHOW DATABASES LIKE '%37656';

-- connection replica
DROP DATABASE BUG37656;
SHOW DATABASES LIKE '%37656';

--source include/rpl_end.inc
