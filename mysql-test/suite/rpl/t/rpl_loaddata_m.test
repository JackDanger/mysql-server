# See if the primary logs LOAD DATA INFILE correctly when binlog_*_db rules
# exist.
# This is for BUG#1100 (LOAD DATA INFILE was half-logged).
######################################################
# Change Author: JBM
# Change Date: 2005-12-22
# Change: Test rewritten to remove show binlog events
#         and to test the option better + Cleanup
######################################################
--source include/not_group_replication_plugin.inc
-- source include/primary-replica.inc

--disable_warnings
drop database if exists mysqltest;
--enable_warnings

connection primary;
# 'test' database should be ignored by the replica
USE test;
CREATE TABLE t1(a INT, b INT, UNIQUE(b));
LOAD DATA INFILE '../../std_data/rpl_loaddata.dat' INTO TABLE test.t1;
SELECT COUNT(*) FROM test.t1;

# 'mysqltest' database should NOT be ignored by the replica
CREATE DATABASE mysqltest;
USE mysqltest;
CREATE TABLE t1(a INT, b INT, UNIQUE(b));
LOAD DATA INFILE '../../std_data/rpl_loaddata.dat' INTO TABLE mysqltest.t1;
SELECT COUNT(*) FROM mysqltest.t1;

# Now lets check the replica to see what we have :-)
--source include/sync_replica_sql_with_primary.inc

SHOW DATABASES;

USE test;
SHOW TABLES;

USE mysqltest;
SHOW TABLES;
SELECT COUNT(*) FROM mysqltest.t1;

#show binlog events;

# Cleanup
connection primary;
DROP DATABASE mysqltest;
DROP TABLE IF EXISTS test.t1;
--source include/sync_replica_sql_with_primary.inc

# End of test
--source include/rpl_end.inc
