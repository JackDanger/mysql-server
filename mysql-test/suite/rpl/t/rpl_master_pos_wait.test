#
# Check what happens when there is an error with parameters provided
# to PRIMARY_POS_WAIT and when it timeouts.
#
--source include/not_group_replication_plugin.inc
source include/primary-replica.inc;
--source include/sync_replica_sql_with_primary.inc
# Bug#18259359 
# To fix sporadic failure due to improper cleanup.
let $rpl_server_number= 1;
source include/rpl_restart_server.inc;
let $rpl_server_number= 2;
source include/rpl_restart_server.inc;
--connection replica
--source include/start_replica.inc

#
# PRIMARY_POS_WAIT: Check if time-out is correctly handled.
#
select primary_pos_wait('primary-bin.999999',0,2);
explain extended select primary_pos_wait('primary-bin.999999',0,2);

#
# PRIMARY_POS_WAIT (BUG#651): Check if it hangs when replica is 
# idle and STOP REPLICA is issued.
#
send select primary_pos_wait('primary-bin.999999',0);
connection replica1;
stop replica sql_thread;
connection replica;
reap;

#
#  PRIMARY_POS_WAIT (BUG#26622): it does not work as documented
#
connection primary;
echo "*** must be empty ***";
query_vertical show replica status;

echo "*** must be NULL ***";
select primary_pos_wait('foo', 98);

# End of 4.1 tests
--let $rpl_only_running_threads= 1
--source include/rpl_end.inc
