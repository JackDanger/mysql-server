# ==== Purpose ====
#
# Test that aliases of variables in binary log aren't ignored with NAME_CONST.
#
# ==== Method ====
#
# Create a procedure with aliases of variables, then replicate it to replica.
# BUG#35515 Aliases of variables in binary log are ignored with NAME_CONST.
#
--source include/not_group_replication_plugin.inc
source include/primary-replica.inc;

--echo ==== Initialize ====

--echo [on primary]
--connection primary

create table t1 (id int);

--echo ==== create a procedure that has a column aliase in a subquery ====
--disable_warnings
drop procedure if exists test_procedure;
--enable_warnings
delimiter $$;
create procedure test_procedure(_id int)
begin
insert into t1 (id)
select a.id
from 
( select _id as id ) a;
end;$$
delimiter ;$$

--echo ==== enable the binary log, then call the procedure ====
call test_procedure(1234);


--echo [on replica]
--source include/sync_replica_sql_with_primary.inc
select * from t1 order by id;

--echo ==== Clean up ====

--echo [on primary]
connection primary;
drop table t1;
drop procedure test_procedure;
--source include/rpl_end.inc
