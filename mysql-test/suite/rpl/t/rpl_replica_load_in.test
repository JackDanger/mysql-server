##########################################################################
# This test verifies if a replica is able to process a "LOAD DATA INFILE" 
# event while the "--secure-file-priv" option is set.
# 
# The test is divided in two steps:
#    1 - Creates tables and populates them through "LOAD DATA INFILE".
#    2 - Compares the primary and replica.
##########################################################################
--source include/have_innodb.inc
--source include/primary-replica.inc

##########################################################################
#                            Loading data
##########################################################################
connection primary;

create table t1(a int not null auto_increment, b int, primary key(a));
create table t2(a int not null auto_increment, b int, primary key(a)) engine=innodb;

load data infile '../../std_data/rpl_loaddata.dat' into table t1;

start transaction;
  insert into t2(b) values (1);
  insert into t2(b) values (2);
  load data infile '../../std_data/rpl_loaddata.dat' into table t2;
  load data infile '../../std_data/rpl_loaddata.dat' into table t2;
commit;

##########################################################################
#                       Checking Consistency
##########################################################################
--source include/sync_replica_sql_with_primary.inc

let $diff_tables= primary:t1, replica:t1;
source include/diff_tables.inc;

let $diff_tables= primary:t2, replica:t2;
source include/diff_tables.inc;

##########################################################################
#                             Clean up
##########################################################################
connection primary;

drop table t1;
drop table t2;

--source include/sync_replica_sql_with_primary.inc
--source include/rpl_end.inc
