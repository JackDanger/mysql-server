###############################################################################
# Bug#18542111:ADD A TEST CASE TO TEST THE BINLOG TRANSACTION CACHE SIZE TO
# 32768 
#
# Problem:
# ========
# When the binlog's IO_CACHE grows up to exact 32768 bytes it
# causes binlog events to get corrupt, if this transaction
# precedes with a transaction whose IO_CACHE size is >32768.
#
# Test:
# =====
# Create a transaction whose size is 37000 so that the event's size exceeds
# 32768 and its contents are flushed to a file. Following this transaction
# add a second transaction whose cache size is exactly 32768.
#
# During execution of third replace statement no assert should be caused.
# Replica should be in sync with primary.
###############################################################################
--source include/not_group_replication_plugin.inc
--source include/have_binlog_format_row.inc
--source include/have_innodb.inc
--source include/primary-replica.inc

--connection primary
DROP TABLE IF EXISTS t1;
CREATE TABLE t1(a varchar(40000))ENGINE=INNODB;
INSERT INTO t1 VALUES (REPEAT('a',37000));
INSERT INTO t1 VALUES (REPEAT('b',32543));
--source include/sync_replica_sql_with_primary.inc

--connection primary
--let $diff_tables=primary:t1,replica:t1
--source include/diff_tables.inc
DROP TABLE t1;

--source include/rpl_end.inc
