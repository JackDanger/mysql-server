-- source include/not_group_replication_plugin.inc
-- source include/have_binlog_format_row.inc
-- source include/primary-replica.inc

# Bug#12415: DROP of temporary table on primary stops replica
connection primary;
--echo **** On Primary ****
CREATE TABLE t1 (a int);
CREATE TABLE t2 (a int);
CREATE TEMPORARY TABLE t2 (a int, b int);
SHOW TABLES;
--source include/sync_replica_sql_with_primary.inc
--echo **** On Replica ****
SHOW TABLES;
connection primary;
--echo **** On Primary ****
DROP TABLE t2;        # Dropping the temporary table
SHOW TABLES;
--source include/sync_replica_sql_with_primary.inc
--echo **** On Replica ****
SHOW TABLES;          # There should be two tables on the replica

connection primary;
--echo **** On Primary ****
CREATE TEMPORARY TABLE t2 (a int, b int);
SHOW TABLES;
--source include/sync_replica_sql_with_primary.inc
--echo **** On Replica ****
SHOW TABLES;
connection primary;
--echo **** On Primary ****
# Should drop the non-temporary table t1 and the temporary table t2
DROP TABLE t1,t2;
source include/show_binlog_events.inc;
SHOW TABLES;
--source include/sync_replica_sql_with_primary.inc
--echo **** On Replica ****
SHOW TABLES;

--disable_query_log
--disable_warnings
connection primary;
DROP TABLE IF EXISTS t2;
--source include/sync_replica_sql_with_primary.inc
--enable_warnings
--enable_query_log
--source include/rpl_end.inc
