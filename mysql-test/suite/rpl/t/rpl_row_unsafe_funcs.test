source include/primary-replica.inc;
source include/have_binlog_format_mixed.inc;

#
# Bug #30244: row_count/found_rows does not replicate well
#

connection primary;

CREATE TABLE t1 (a INT); 
CREATE TABLE t2 (a INT, b INT); 

INSERT INTO t1 SELECT 1;

connection primary1;
INSERT INTO t1 VALUES (2),(3),(4),(5),(6);

connection primary;
INSERT INTO t2 SELECT 1, ROW_COUNT();

INSERT INTO t1 VALUES (2),(3),(4);
INSERT INTO t2 SELECT 2, ROW_COUNT();

#must return 1 and 3
SELECT b FROM t2 ORDER BY a;

--source include/sync_replica_sql_with_primary.inc

#must return 1 and 3
SELECT b FROM t2 ORDER BY a;

connection primary;
DROP TABLE t1, t2;
--source include/sync_replica_sql_with_primary.inc
connection primary;
--source include/rpl_end.inc
