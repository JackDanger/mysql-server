###############################################################################
# Bug#13963 SHOW REPLICA HOSTS is unreliable
#
# Replicas only appear in the output of SHOW REPLICA HOSTS when report-host option
# is set. If an expected replica does not appear in the list, nobody knows
# whether the replica does not connect or has started without the "report-host"
# option.
#
# Remove the "Rpl_recovery_rank" column from SHOW REPLICA HOSTS, It is not
# implemented.
#######################################################################
--source include/not_group_replication_plugin.inc
source include/primary-replica.inc;
connect (replica2,127.0.0.1,root,,test,$REPLICA_MYPORT2,);

connection replica2;
RESET REPLICA;
--replace_result $PRIMARY_MYPORT PRIMARY_PORT
--replace_column 2 ####
--eval CHANGE PRIMARY TO primary_host='127.0.0.1',primary_port=$PRIMARY_MYPORT,primary_user='root'
START REPLICA IO_THREAD;
source include/wait_for_replica_io_to_start.inc;

connection primary;
let $show_statement= SHOW REPLICA HOSTS;
let $field= Server_id;
# 3 is server_id of replica2.
let $condition= ='3';
source include/wait_show_condition.inc;
--replace_column 3 'REPLICA_PORT'
--replace_result $REPLICA_MYPORT REPLICA_PORT $DEFAULT_PRIMARY_PORT DEFAULT_PORT
source include/show_replica_hosts.inc;

connection replica2;
--source include/stop_replica_io.inc

connection primary;
let $show_statement= SHOW REPLICA HOSTS;
let $field= Server_id;
# 3 is server_id of replica2.
let $condition= <> '3';
# All rows of 'SHOW REPLICA HOSTS' are not equal to 3.  It mean that primary has
# knew the leave of replica2 and has unregistered it.
let $wait_for_all= 1;
source include/wait_show_condition.inc;
source include/show_replica_hosts.inc;

--source include/rpl_end.inc
