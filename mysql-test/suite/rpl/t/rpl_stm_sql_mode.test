-- source include/not_group_replication_plugin.inc
-- source include/have_binlog_format_statement.inc
-- source include/primary-replica.inc

#
# Bug #51055    Replication failure on duplicate key + traditional SQL mode
#

CREATE TABLE t1 (pk integer auto_increment , primary key (pk));

SET SESSION SQL_MODE='traditional';

-- echo # **** [PRIMARY] *****
-- echo # action: raise DUP KEY error (error code should be set in the 
-- echo #                              query log event)
-- error ER_DUP_ENTRY
INSERT INTO t1 (`pk`) VALUES (1), (1);

DROP TABLE t1;

-- echo # **** [ sync replica with primary ] ****
-- echo # assertion: sync replica with primary makes replica not to stop with
-- echo #            duplicate key error (because it has received event
-- echo #            with expected error code).
--source include/sync_replica_sql_with_primary.inc
--source include/rpl_end.inc
